{% extends 'base.html' %} {% load static %} {% block content %}


<body>
    <!--------------- blog-tittle-section---------------->
    <section class="blog about-blog">
        <div class="container">
            <div class="blog-bradcrum">
                <span><a href="index.html">Home</a></span>
                <span class="devider">/</span>
                <span><a href="#">Checkout</a></span>
            </div>
            <div class="blog-heading about-heading">
                <h1 class="heading">Checkout</h1>
            </div>
        </div>
    </section>
    <!--------------- blog-tittle-section-end---------------->

    <!-- Bootstrap Modal Example -->
    <div class="modal fade" id="bankTransferModal" tabindex="-1" role="dialog" aria-labelledby="bankTransferModalLabel" aria-hidden="true">
        <div class="modal-dialog" role="document">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="bankTransferModalLabel">Bank Transfer Details</h5>
                    <span aria-hidden="true">&times;</span>
                </div>
                <div class="modal-body">
                    <p>Make your payment directly into our bank account with the following details:</p>
                    <p><strong>Bank Name:</strong> Nedbank</p>
                    <p><strong>Account Number:</strong> 1243577479</p>
                    <p><strong>Reference:</strong> {{ order_id }}</p>
                </div>
                <div class="modal-footer">
                    <!-- Add any additional buttons or links here -->
                </div>
            </div>
        </div>
    </div>


    <!--------------- checkout-section---------------->
    <section class="checkout product footer-padding">
        <div class="container">
            <div class="checkout-section">
                <form method="post" action="{% url 'checkout' %}">
                    {% csrf_token %}
                    <div class="row gy-5">
                        <div class="col-lg-6">
                            <div class="checkout-wrapper">
                                {% if user.is_authenticated %}
                                <!-- User is logged in -->
                                <p>Welcome, {{ user.username }}!</p>
                                {% else %}
                                <!-- User is not logged in -->
                                <a href="{% url 'login' %}" class="shop-btn">Log into Your Account</a> {% endif %}
                                <div class="account-section billing-section">
                                    <h5 class="wrapper-heading">Billing Details</h5>
                                    <div class="review-form">
                                        <div class="account-inner-form">
                                            <div class="review-form-name">
                                                <label for="id_first_name" class="form-label">First Name*</label>
                                                <input type="text" id="id_first_name" name="first_name" class="form-control" placeholder="First Name">
                                            </div>
                                            <div class="review-form-name">
                                                <label for="id_last_name" class="form-label">Last Name*</label>
                                                <input type="text" id="id_last_name" name="last_name" class="form-control" placeholder="Last Name">
                                            </div>
                                        </div>
                                        <div class="account-inner-form">
                                            <div class="review-form-name">
                                                <label for="id_email" class="form-label">Email*</label>
                                                <input type="email" id="id_email" name="email" class="form-control" placeholder="user@gmail.com">
                                            </div>
                                            <div class="review-form-name">
                                                <label for="id_phone" class="form-label">Phone*</label>
                                                <input type="tel" id="id_phone" name="phone_number" class="form-control" placeholder="+880388**0899">
                                            </div>
                                        </div>
                                        <div class="review-form-name">
                                            <label for="id_country" class="form-label">Country*</label>
                                            <select id="id_country" name="country" class="form-select">
                                                <option>Choose...</option>
                                                <option>Bangladesh</option>
                                                <option>United States</option>
                                                <option selected>United Kingdom</option>
                                            </select>
                                        </div>
                                        <div class="review-form-name address-form">
                                            <label for="id_address" class="form-label">Address*</label>
                                            <input type="text" id="id_address" name="address" class="form-control" placeholder="Enter your Address">
                                        </div>
                                        <div class="account-inner-form city-inner-form">
                                            <div class="review-form-name">
                                                <label for="id_city" class="form-label">Town / City*</label>
                                                <select id="id_city" name="city" class="form-select">
                                                    <option>Choose...</option>
                                                    <option>Newyork</option>
                                                    <option>Dhaka</option>
                                                    <option selected>London</option>
                                                </select>
                                            </div>
                                            <div class="review-form-name">
                                                <label for="id_postal_code" class="form-label">Postcode / ZIP*</label>
                                                <input type="number" id="id_postal_code" name="postal_code" class="form-control" placeholder="0000">
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="col-lg-6">
                            <div class="checkout-wrapper">
                                <a href="#" class="shop-btn">Enter Coupon Code</a>
                                <div class="account-section billing-section">
                                    <h5 class="wrapper-heading">Order Summary</h5>
                                    <div class="order-summery">
                                        <div class="subtotal product-total">
                                            <h5 class="wrapper-heading">PRODUCT</h5>
                                            <h5 class="wrapper-heading">TOTAL</h5>
                                        </div>
                                        {% for order_item in cart_items %}
                                        <div class="subtotal product-total">
                                            <ul class="product-list">
                                                <li>
                                                    <div class="product-info">
                                                        <h5 class="wrapper-heading">{{ order_item.product.name }}</h5>
                                                        <p class="paragraph">{{ order_item.product.description }}</p>
                                                    </div>
                                                    <div class="price">
                                                        <h5 class="wrapper-heading">R{{ order_item.product.price }}</h5>
                                                    </div>
                                                </li>
                                            </ul>
                                        </div>
                                        <hr>

                                        <div class="subtotal product-total">
                                            <h5 class="wrapper-heading">SUBTOTAL</h5>
                                            <h5 class="wrapper-heading">R{{ order_item.get_total_price }}</h5>
                                        </div>
                                        <div class="subtotal product-total">
                                            <ul class="product-list">
                                                <li>
                                                    <div class="product-info">
                                                        <p class="paragraph">SHIPPING</p>
                                                        <h5 class="wrapper-heading">Free Shipping</h5>
                                                    </div>
                                                    <div class="price">
                                                        <h5 class="wrapper-heading">+R0</h5>
                                                    </div>
                                                </li>
                                            </ul>
                                        </div>
                                        <hr>
                                        <div class="subtotal total">
                                            <h5 class="wrapper-heading">TOTAL</h5>
                                            <h5 class="wrapper-heading price">R{{ order_item.get_total_price }}</h5>
                                        </div>
                                        <p><strong>Reference:</strong> {{ order_id }}</p>
                                        {% endfor %}

                                        <div class="subtotal payment-type">
                                            <div class="checkbox-item">
                                                <input type="radio" id="bank" name="payment_option" class="form-check-input">
                                                <div class="bank">
                                                    <h5 class="wrapper-heading">Direct Bank Transfer</h5>
                                                    <p class="paragraph">Make your payment directly into our bank account. Please use
                                                        <span class="inner-text">
                        your Order ID as the payment reference.
                    </span>
                                                    </p>
                                                </div>
                                            </div>
                                            <div class="checkbox-item">
                                                <input type="radio" id="payfast" name="payment_option" value="payfast" class="form-check-input">
                                                <div class="cash">
                                                    <h5 class="wrapper-heading">Payfast</h5>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <button type="submit" class="btn btn-primary btn-block mt-3" id="process-payment">Process Payment</button>

                </form>

            </div>
        </div>
    </section>


    <!--------------- checkout-section-end---------------->



</body>

<script>
    document.addEventListener('DOMContentLoaded', function() {
        const form = document.querySelector('form');
        const bankRadio = document.getElementById('bank');
        const payfastRadio = document.getElementById('payfast');

        // Function to handle form submission
        form.addEventListener('submit', function(event) {
            event.preventDefault(); // Prevent default form submission

            // Perform form validation if needed

            // Check which radio option is selected
            if (bankRadio.checked) {
                // Handle bank transfer submission (if necessary)
                showModal(); // Show modal or handle bank transfer logic
            } else if (payfastRadio.checked) {
                // Redirect to PayFast payment page
                const totalAmount = '{{ total_price }}'; // Replace with actual total amount from Django context
                const itemName = '{{ item_names|join:", " }}'; // Replace with item names from Django context

                const redirectUrl = `https://www.payfast.co.za/eng/process?merchant_id=23353254&merchant_key=r7cx2yvt9i7gf&amount=${totalAmount}&item_name=${itemName}`;

                window.location.href = redirectUrl;
            } else {
                // Handle other payment options or show error message
                alert('Please select a payment option.');
            }
        });

        function showModal() {
            // Implement your modal logic here
            // Example: Bootstrap modal
            $('#bankTransferModal').modal('show'); // Replace with your modal ID and show function
        }
    });
</script>






{% endblock %}